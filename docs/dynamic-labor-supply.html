<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />
<!--[if lt IE 9]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.ie.min.css" />
<![endif]-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Econ 34430</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-pencil"></span>
     
    Homeworks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="static-labor-supply.html">Static LS</a>
    </li>
    <li>
      <a href="dynprog-HotzMiller.html">Hotz and Miller</a>
    </li>
    <li>
      <a href="dynamic-labor-supply.html">Dynamic LS</a>
    </li>
    <li>
      <a href="earnings-mixtures.html">Mixtures</a>
    </li>
    <li>
      <a href="ShimerSmith.html">Sorting</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tlamadon/econ-34430">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/tlamadon/econ-34430/issues">
    <span class="fa fa-bug"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="dynamic-labor-supply" class="section level1">
<h1>Dynamic labor supply</h1>
<div id="a-simple-numerical-model" class="section level2">
<h2>A simple numerical model</h2>
<p>We are going to cover the first steps to solving and simulating a dynamic programing problem. We consider a labor supply problem with asset and simple choices over hours. We will allow for sthochastic productivity. We are going to consider here a finite horizon problem.</p>
<p>The decision problem for the agent is to choose every period, how much to consume, how much to work and how much to save. We are going to solve this at a yearly frequency over 50 years.</p>
<div id="setting-the-environment" class="section level3">
<h3>Setting the environment</h3>
<p>The state space is given by age, producitivity and asset level. We consider the separable utility function over leisure and consumption. We fix all parameters. WE also consider a simple end of life value.</p>
<p>We prepare the wage realizations in each state and the value function.</p>
<pre class="r"><code>p    = list(nx=30,na=40,nb=100,nh=10,gamma = 2, eta=-1.5 , lambda=0.1,r=0.02,beta=5,fc=1)
V    = array(0,c(p$na,p$nx,p$nb))
X    = exp(  qnorm((1:(p$nx))/(p$nx+1)))  
B    = c(0,exp(seq(log(min(X)),log(max(X/p$r)),l=p$nb-1)))
H    = seq(0,1,l=p$nh)
wage = X

# transition matrix on productivity
X1 = spread(X,1,p$nx);X2 = spread(X,2,p$nx);
Gx = dnorm(log(X2)-log(X1))
Gx = Gx/spread(rowSums(Gx),2,p$nx)
persp(Gx)</code></pre>
<p><img src="dynamic-labor-supply_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>We then solve the dynamic problem recursively. In the last period, we let the agent choose a single consumption and hours value that will make asset level 0.</p>
<p>First step is to solve the final period problem. We assume that the agent has a access to a producitivity which is a thrid of the last period one, and then choose hours and consumption to make asset to 0.</p>
<pre class="r"><code>t.final = tensorFunction(R[b,w,h] ~  ((W[w]*H[h] + r*B[b])^(1+eta))/(1+eta) - beta*((H[h])^(1+gamma))/(1+gamma) - I(H[h]&gt;0)*fc)
VV      = t.final(X/3,H,B,p$r,p$eta,p$beta,p$gamma,p$fc)
Vf      = aaply(VV,c(1,2),max,na.rm=T)

# plotting the function
ggplot(melt(Vf,c(&quot;b&quot;,&quot;x&quot;)),aes(x=b,y=value,color=x,group=x))+geom_line() + theme_bw() + scale_x_continuous(&quot;asset position&quot;)</code></pre>
<p><img src="dynamic-labor-supply_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>We then solve the values recursively</p>
<pre class="r"><code>V[p$na,,] = t(Vf)/p$r

# prepare tensor that computes the Q value for each b,x,h,b2
t.cur = tensorFunction(R[b,x,h,b2] ~  ((W[x]*H[h] - B[b2] + (1+r)*B[b])^(1+eta))/(1+eta) - beta*((H[h])^(1+gamma))/(1+gamma) + rho*VV[x,b2] - I(H[h]&gt;0)*fc )

B.pol = V*0
H.pol = V*0

for (age in (p$na-1):1) {
  # compute expected value tomorrow
  EV = Gx %*% V[age+1,,]
  # compute values at each control variables
  Vn = t.cur(W=X*exp(p$lambda * age/p$na) ,H,B,EV,p$r,p$eta,p$beta,p$gamma,1/(1+p$r),p$fc)
  # we need to choose the asset tomorrow and hours (which then gives consumption)
  V[age,,] = t(aaply(Vn,c(1,2),max,na.rm=T))
  # extract policy
  pol = aaply(Vn,c(1,2),function(A) which(A==max(A,na.rm=T),arr.ind = T,useNames = T))
  B.pol[age,,] = t(pol[,,2])
  H.pol[age,,] = t(pol[,,1])
  cat(&quot;.&quot;)
}</code></pre>
<pre><code>## .......................................</code></pre>
<pre class="r"><code># let&#39;s plot hours at fix x and b over time
rr= data.table(melt(H.pol[,,25],c(&quot;age&quot;,&quot;x&quot;)))
ggplot(rr[x %in% c(5,10,15,20,25)][age&lt;40],aes(x=age,y=value,color=x,group=x)) + geom_line()</code></pre>
<p><img src="dynamic-labor-supply_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="simulating-data" class="section level3">
<h3>Simulating data</h3>
<p>Finally we simulate some data</p>
<pre class="r"><code>simdata = data.frame()
D = array(0,c(p$na-1,6))
colnames(D) = c(&quot;i&quot;,&quot;x&quot;,&quot;b&quot;,&quot;h&quot;,&quot;b2&quot;,&quot;age&quot;)
  
for (i in 1:1000) {
  x=sample.int(p$nx,1)
  b=1
  for (age in 1:(p$na-1)) {
    x = sample.int(p$nx,1,prob=Gx[x,])
    D[age,1] = i
    D[age,2] = x
    D[age,3] = b
    D[age,4] = H.pol[age,x,b]
    D[age,5] = B.pol[age,x,b]
    D[age,6] = age
    b        = B.pol[age,x,b]
  }
  simdata=rbind(simdata,data.frame(D))
}
simdata = data.table(simdata)
simdata[,lw := log(X[x]),x]</code></pre>
<pre><code>##           i  x  b  h b2 age         lw
##     1:    1 21  1  9 25   1  0.4604945
##     2:    1 12 25  7 26   2 -0.2868939
##     3:    1  1 26  1 20   3 -1.8485963
##     4:    1 10 20  7 20   4 -0.4604945
##     5:    1 21 20  9 31   5  0.4604945
##    ---                                
## 38996: 1000 23 62  8 63  35  0.6493239
## 38997: 1000 25 63  8 64  36  0.8648944
## 38998: 1000  8 64  1 64  37 -0.6493239
## 38999: 1000 13 64  1 64  38 -0.2035442
## 39000: 1000 20 64 10 65  39  0.3722894</code></pre>
<pre class="r"><code>simdata[,lb := log(B[b]),b]</code></pre>
<pre><code>##           i  x  b  h b2 age         lw          lb
##     1:    1 21  1  9 25   1  0.4604945        -Inf
##     2:    1 12 25  7 26   2 -0.2868939 -0.06275998
##     3:    1  1 26  1 20   3 -1.8485963  0.01488508
##     4:    1 10 20  7 20   4 -0.4604945 -0.45098526
##     5:    1 21 20  9 31   5  0.4604945 -0.45098526
##    ---                                            
## 38996: 1000 23 62  8 63  35  0.6493239  2.81010713
## 38997: 1000 25 63  8 64  36  0.8648944  2.88775219
## 38998: 1000  8 64  1 64  37 -0.6493239  2.96539724
## 38999: 1000 13 64  1 64  38 -0.2035442  2.96539724
## 39000: 1000 20 64 10 65  39  0.3722894  2.96539724</code></pre>
<pre class="r"><code># choice of hours
ggplot(simdata,aes(x=age,y=h)) + geom_smooth() +theme_bw()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39;</code></pre>
<p><img src="dynamic-labor-supply_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code># compute asset 
ggplot(simdata,aes(x=age,y=lb)) + geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39;</code></pre>
<pre><code>## Warning: Removed 2043 rows containing non-finite values (stat_smooth).</code></pre>
<p><img src="dynamic-labor-supply_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<pre class="r"><code>simdata[,hist(h)]</code></pre>
<p><img src="dynamic-labor-supply_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre><code>## $breaks
##  [1]  1.0  1.5  2.0  2.5  3.0  3.5  4.0  4.5  5.0  5.5  6.0  6.5  7.0  7.5
## [15]  8.0  8.5  9.0  9.5 10.0
## 
## $counts
##  [1] 16122     0     0     0     0     0     0   121     0  2803     0
## [12]  1486     0  5413     0  5093     0  7962
## 
## $density
##  [1] 0.826769231 0.000000000 0.000000000 0.000000000 0.000000000
##  [6] 0.000000000 0.000000000 0.006205128 0.000000000 0.143743590
## [11] 0.000000000 0.076205128 0.000000000 0.277589744 0.000000000
## [16] 0.261179487 0.000000000 0.408307692
## 
## $mids
##  [1] 1.25 1.75 2.25 2.75 3.25 3.75 4.25 4.75 5.25 5.75 6.25 6.75 7.25 7.75
## [15] 8.25 8.75 9.25 9.75
## 
## $xname
## [1] &quot;h&quot;
## 
## $equidist
## [1] TRUE
## 
## attr(,&quot;class&quot;)
## [1] &quot;histogram&quot;</code></pre>
</div>
</div>
</div>

<!--<a href="https://github.com/you"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a> -->
<a class="github-fork-ribbon right-bottom fixed" href="https://github.com/tlamadon/econ-34430" title="Fork me on GitHub">Fork me on GitHub</a>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
